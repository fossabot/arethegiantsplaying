<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="utf-8">
        <title>Is there a Giants game today?</title>
        <link href='http://fonts.googleapis.com/css?family=Permanent+Marker' rel='stylesheet' type='text/css'>
        <style type="text/css">
            body { margin: auto; font-family: Helvetica, Arial, sans-serif;
              line-height:1.3; text-align:center; width:60%; margin:0 auto;}
            #isthere { margin-top: 5%; font-size: 50px; }
            #yesno { margin-bottom: 2em; border-top:1px solid #D2612F;
              border-bottom:1px solid #D2612F; padding-bottom:30px;}
            #game { font-size: 50px; }
            #footer { margin: 30px; }
            
            a:link, a:visited { text-decoration: none; color: #D2612F; }
            a:hover { border-bottom: 2px solid black ; }
            a#counter:hover { border: 0; text-decoration: underline; }
            
            .fill-in { font-family: 'Permanent Marker', arial, serif; font-size: 150px; }
            .homeaway { font-weight: bold; font-size: 50px; }
            .home { background: #000000; color: #D2612F; }
            .away { background: #FFFFFF; color: #000000; }
            .boxscore {font-size: 16px; width: 370px; margin: 30px auto 10px auto;}
            .boxscore table {
              border: 1px solid #666;
              width: 370px;
            }
            .boxscore td {border: 1px solid #666; width: 25px;}
            .boxscore .team, .awayteam, .hometeam {
              text-align: left;
              width: 100px;
            }
            .boxscore .inning {color: #666;}
            .boxscore .giants {color: #FFF;}
            .boxscore .opponent {color: #FFF;}
        </style>
    </head>
    <body>
            <h1 id="isthere">Is there a Giants game today?</h1>
            <div id="yesno">
                <span class="fill-in">...</span>
                <br />
                <span class="homeaway"></span>
            </div>
            
            <div id="game" class="h-event vevent" style="display: none">
                <span class="p-summary summary">Giants play the 
                      <span class="opponent"></span>
                </span>
                <span class="day"></span>
                <span class="dt-start dtstart">
                    <abbr class="value" style="display: none"></abbr>
                        <span class="tstart value"></span>
                        at <span class="p-location location"></span>
                </span>
                <span class="dt-end dtend">
                    <span class="tend value"></span>
                </span>
                <br>
                <div class="boxscore">
                  <table>
                    <tr class="boxheader">
                      <td class="team"></td>
                      <td class="inning">1</td>
                      <td class="inning">2</td>
                      <td class="inning">3</td>
                      <td class="inning">4</td>
                      <td class="inning">5</td>
                      <td class="inning">6</td>
                      <td class="inning">7</td>
                      <td class="inning">8</td>
                      <td class="inning">9</td>
                      <td class="final">F</td>
                    </tr>
                    <tr class="awayscore">
                      <td class="awayteam"></td>
                      <td class="score1"></td>
                      <td class="score2"></td>
                      <td class="score3"></td>
                      <td class="score4"></td>
                      <td class="score5"></td>
                      <td class="score6"></td>
                      <td class="score7"></td>
                      <td class="score8"></td>
                      <td class="score9"></td>
                      <td class="awayruns"></td>
                    </tr>
                    <tr class="homescore">
                      <td class="hometeam"></td>
                      <td class="score1"></td>
                      <td class="score2"></td>
                      <td class="score3"></td>
                      <td class="score4"></td>
                      <td class="score5"></td>
                      <td class="score6"></td>
                      <td class="score7"></td>
                      <td class="score8"></td>
                      <td class="score9"></td>
                      <td class="homeruns"></td>
                    </tr>
                  </table>
                </div>
            </div>

            <div id="datecheck"></div>
            <div id="footer"><a href="about.html">about</a></div>

        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
        
        <script type="text/javascript">
        function isDateLaterThan(a, b) {
          return a > b;
        }
        
        /* from https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Date */
        function ISODateString(d){  
            function pad(n){return n<10 ? '0'+n : n}  
            return d.getUTCFullYear()+'-'  
                + pad(d.getUTCMonth()+1)+'-'  
                + pad(d.getUTCDate());
        }  
        
        $(document).ready(function(){
            var url='data/giants2012schedule.json';
            
            // var linescore_url = 'http://gd2.mlb.com/components/game/mlb/year_2012/month_04/day_27/gid_2012_04_27_sdnmlb_sfnmlb_1/linescore.json';

            var linescore_url = 'data/linescore.json';
            var linescore_url_dyn = '';

            var today = new Date();
            var nextGame = null;
            var todaysGame = null;
            
            // Format date as MM/DD/YY
            var curr_date = today.getDate();
            var curr_month = today.getMonth();
            curr_month++;
            var curr_year = today.getFullYear();
            var dateString = curr_month + "/" + curr_date + "/" + curr_year;

            // Create datepicker
            // $("#datecheck").html('Checking <input id="datepicker" type="text">');
    		// $( "#datepicker" ).datepicker();

            // $(".datepicker").datepicker.("setDate", dateString);
        
            // Check for game today
            $.getJSON(url,function(json){
                var nextGameDate;
                
                $.each(json.games,function(i,game){
                    nextGameDate = new Date(game.date);
                       
                    // Uncomment for debugging 
                    // console.log("Today: " + today + " - Looking at game: " + nextGameDate);
        
                  if (!nextGame && isDateLaterThan(nextGameDate, today))
                    nextGame = game;
                  
                    if(today.getYear() == nextGameDate.getYear() && today.getMonth() == nextGameDate.getMonth() && today.getDate() == nextGameDate.getDate()) {
                      todaysGame = game;
                    }   

                if (curr_month < 10) {
                  if (curr_date<10) {
                    linescore_url_dyn = 'http://gd2.mlb.com/components/game/mlb/year_2012/month_0' + 
                    curr_month + '/day_0' + curr_date + '/' + game.url + 'linescore.json';
                  } 
                  else {
                    linescore_url_dyn = 'http://gd2.mlb.com/components/game/mlb/year_2012/month_0' + 
                    curr_month + '/day_' + curr_date + '/' + game.url + 'linescore.json;'
                  }
                }
                else {
                  if (curr_date<10)
                  {
                    linescore_url_dyn = 'http://gd2.mlb.com/components/game/mlb/year_2012/month_' + 
                    curr_month + '/day_0' + curr_date + '/' + game.url + 'linescore.json';
                  } 
                  else {
                    linescore_url_dyn = 'http://gd2.mlb.com/components/game/mlb/year_2012/month_' + 
                    curr_month + '/day_' + curr_date + '/' + game.url + 'linescore.json;'
                  }
                }
                
                console.log(linescore_url_dyn);         
                });

                // linescore_url_dyn = 'http://gd2.mlb.com/components/game/mlb/year_2012/month_0' + 
                // curr_month + '/day_' + curr_date + '/gid_2012_0' + curr_month + '_' + curr_date + 
                // '_';
                // console.log(linescore_url_dyn);

                if (todaysGame) {
                    $(".fill-in").text("YES");
                    $("#game .summary").text("Giants play the " + todaysGame.opponent);
                    $("#game .location").text(todaysGame.location);
                    $("#game .tstart").text(todaysGame.time);
                    
                    $("#game abbr").attr('title', ISODateString(nextGameDate));
                    if (todaysGame.location == "AT&T Park") {
                        $("body").addClass("home");
                        $("#yesno .homeaway").text("At home");
                     }
                     else {
                        $("body").addClass("away");
                        $("#yesno .homeaway").text("Away");
                        $("#yesno").css("border-color", "#000");
                     }
                    $("#game").show();
                }
                else {
                  $(".fill-in").text("NO");
                  $("#game .date").text(nextGame.date);
                  $("#game .summary").text("Giants will play the " + nextGame.opponent);
                  $("#game .location").text(nextGame.location);
                  
                  // Formate next game date as day of the week
                  var weekday = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
                  var nextGameDay = weekday[nextGameDate.getDay()];
                  $("#game .day").text("on " + nextGameDay);
                  $("#game .tstart").text(nextGame.time);
                  // if (nextGame.location == "AT&T Park") {
                  //  $("#nextgame .location").addClass("homegame");
                  //   $("body").addClass("homegame-bg");
                  // }
                  $("#game").show();
                }
            });
            $.getJSON(linescore_url, function(json) {
            // body...
            console.log(json.data.game);

              $("#game .awayteam").append(json.data.game.away_team_name);
              $.each(json.data.game.linescore, function(i,inning){
                $("#game .awayscore .score" + (i+1)).append(inning.away_inning_runs);
              });
              $("#game .awayruns").append(json.data.game.away_team_runs);

              $("#game .hometeam").append(json.data.game.home_team_name);
              $.each(json.data.game.linescore, function(i,inning){
                $("#game .homescore .score" + (i+1)).append(inning.home_inning_runs);
              });
              $("#game .homeruns").append(json.data.game.home_team_runs);

              if (json.data.game.venue == "AT&T Park") {
                $("#game .homeruns").addClass("giants");
                $("#game .awayruns").addClass("opponent");
                $("#game .hometeam").text("Giants");
                $("#game .awayteam").text(json.data.game.away_team_name);
              }
              else {
                $("#game .homeruns").addClass("opponent");
                $("#game .awayruns").addClass("giants");
                $("#game .awayteam").text("Giants");
                $("#game .hometeam").text(json.data.game.home_team_name);
              }
            });

        });    
        </script>
    
        <!--Google Analytics Script-->
        // <script type="text/javascript">
        
        //   var _gaq = _gaq || [];
        //   _gaq.push(['_setAccount', 'UA-19429437-1']);
        //   _gaq.push(['_trackPageview']);
        
        //   (function() {
        //     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        //     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        //     var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        //   })();
        
        // </script>
    </body>
</html>
